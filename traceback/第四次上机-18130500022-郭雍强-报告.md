![image-20210528215829814](第四次上机-18130500022-郭雍强-报告.assets/image-20210528215829814.png)

<center><div><span style='font-size: 24px; font-family: SimHei; text-align: center'>算法分析与设计（本科）</span></div></center>

<center><div><span style='font-size: 24px; font-family: SimHei; text-align: center'>上机报告</span></div></center>

![image-20210528215845742](第四次上机-18130500022-郭雍强-报告.assets/image-20210528215845742.png)





<div style='align: center; width: 40%; margin:auto;'>
<div style="display: inline; font-size: 15px; font-family: simsun; vertical-align: base-line;">
<div style='display: flex; flex-direction:row;'><div><text>学  院：</text></div><div style='flex-grow:1; border-bottom:1px solid rgba(0,0,0,1); text-align:center;'>计算机科学与技术学院</div></div>
<div style='display: flex; flex-direction:row;'><div>专  业：</div><div style='flex-grow:1; border-bottom:1px solid rgba(0,0,0,1); text-align:center;'>软件工程</div></div>
<div style='display: flex; flex-direction:row;'><div>方  向：</div><div style='flex-grow:1; border-bottom:1px solid rgba(0,0,0,1); text-align:center;'>计算机科学与技术学院</div></div>
<div style='display: flex; flex-direction:row;'><div>姓  名：</div><div style='flex-grow:1; border-bottom:1px solid rgba(0,0,0,1); text-align:center;'>郭雍强</div></div>
<div style='display: flex; flex-direction:row;'><div>学  号：</div><div style='flex-grow:1; border-bottom:1px solid rgba(0,0,0,1); text-align:center;'>18130500022</div></div>    
</div>
</div>



















# 搜索回溯算法



## 1. 01背包问题

给出一些物品和他们的价值、重量，背包的容量是固定的，每个物品只能选择装或不装。需要给出不超出背包容量的前提下，能够使背包内物品价值最大的选择方案。(应用回溯法解决）

测试样例：

| 价值      | 20   | 30   | 65   | 40   | 60   |
| --------- | ---- | ---- | ---- | ---- | ---- |
| 重量      | 10   | 20   | 30   | 40   | 50   |
| 价值/重量 | 2    | 1.5  | 2.1  | 1    | 1.2  |



### 1.1 题目分析

解题思路是对每个物品决定装和不装，遍历这个解空间来确定价值最大的方案。如果物品数量是$n$，有$2^n$种方案，采用深度优先遍历。

剪枝时，可以可以先计算出所有物品按照价值降序排列后的部分和数组，表示未作决定的几个物品可以产生的最大价值。如果当前物品的价值再加上剩余物品的最大价值仍小于目前的最大价值，这种方案就无法再继续下去，决定剪枝。

### 1.2 算法实现

```c++
// 搜索、剪枝部分的核心代码
// Solution::search(int i, bool takes)
// use as search(-1, false);
void search(int i, bool takes) {
    if (i >= this->_n+1) {
        return ;
    }

    // 剪枝， 如果已经超出容量 或 已经不可能获得最大价值，则剪枝回溯
    if (this->cur_volume < 0 ||
        (i > 0 && i < this->_n && cur_value + most_valuables[this->_n-i-1] <= max_value)) {

        this->cur_value -= this->taken[i-1]*this->items[i-1].v;
        this->cur_volume += this->taken[i-1]*this->items[i-1].w;
        this->taken[i-1] = false;
        return ;
    }

    // 所有物品取舍确定，检查是否出现最大价值，然后回溯
    if (i == this->_n) {
        if (this->cur_value > this->max_value && this->cur_volume >= 0) {
            this->max_value = this->cur_value;
            this->opt_taken = this->taken;
        }

        this->cur_value -= this->taken[i-1]*this->items[i-1].v;
        this->cur_volume += this->taken[i-1]*this->items[i-1].w;
        this->taken[i-1] = false;
        return ;
    }

    if (i >= 0 && takes) {
        this->cur_volume -= this->items[i].w;
        cur_value += this->items[i].v;
        this->taken[i] = true;
    }

    log(i);
    search(i+1, false);
    search(i+1, true);

    // 遍历完所有子分支后回溯状态
    if (i >= 0) {
        this->cur_value -= this->taken[i]*this->items[i].v;
        this->cur_volume += this->taken[i]*this->items[i].w;
        this->taken[i] = false;
    }
}
```



### 1.3 运行结果

<img src="C:\Users\18488\Desktop\Current_Learning\term6courses\Algorithm Analysis and Designation\上机\practice4\搜索回溯算法.assets\01knapsack_res.png" style="zoom: 50%;" />

## 2. 8皇后问题

在一个$8\times8$的国际象棋棋盘上摆放8个皇后，使其不能相互攻击，输出所有摆放方式和方案数。皇后的攻击范围是整行、整列和对角线。

### 2.1 题目分析

根据皇后攻击范围的规则，可以使用一个一维数组来表示皇后的位置，A[i]=j表示在棋盘的第i+1行、第j+1列有一个皇后。通过遍历每个皇后可以摆放的位置来找出可行的方案，采用深度优先遍历。递归搜索的终止条件为搜索到第9行。

剪枝时，假设目前已经摆放皇后的位置包括$P=\{p_1,p_2,...,p_k\}$，因为已经确定好位置的皇后对每一行的影响范围最多就是同列以及主副对角线三个位置，在遍历第$k+1$行皇后的位置时就应该去掉$P+\{p_{j}+(k+1-j),p_{j}-(k+1-j)|j=1,2,...,k\}$，如果第$k+1$行已经没有位置能够摆放皇后则剪枝。



### 2.2 算法实现

#### 2.2.1 删除皇后之间冲突的位置

```c++
// Solution::legal_area(int r);
// 根据已经确定的皇后位置（pos[i]!=-1）返回第r行皇后的可行位置
const vector<bool>& legal_area(int r) {
    allow = vector<bool>((int)pos.size(), true);
    for (int i = 0; i < r; ++ i) {
        if (pos[i] >= 0) {
            // 不同能处在同一列、同一对角线
            allow[pos[i]] = false;
            if (pos[i]+(r-i) >= 0 && pos[i]+(r-i) < (int)pos.size()) {
                allow[pos[i]+(r-i)] = false;
            }
            if (pos[i]-(r-i) >= 0 && pos[i]-(r-i) < (int)pos.size()) {
                allow[pos[i]-(r-i)] = false;
            }
        }
    }
    return allow;
}
```

#### 2.2.2 搜索回溯部分的核心代码

```c++
// Solution::search(int r);
// use as search(0)
void search(int r) {
    // 如果搜索到了r=pos.size()说明1...r个皇后都是互相不冲突的
    if (r == (int)pos.size()) {
        valid.push(pos);
        return ;
    }

    vector<bool> allow = legal_area(r);

    for (int i = 0; i < (int)allow.size(); ++i) {
        if (allow[i]) {
            pos[r] = i;
            search(r+1);
            // 遍历完所有皇后的可行位置后，回溯子分支的状态
            pos[r] = -1;
        }
    }
}
```



### 2.3 运行结果

求解得到8皇后问题共有92种摆放方式。

![](C:\Users\18488\Desktop\Current_Learning\term6courses\Algorithm Analysis and Designation\上机\practice4\搜索回溯算法.assets\8queen_res.png)

所有的皇后排列方案如下：

|  ID  | queen1 | queen2 | queen3 | queen4 | queen5 | queen6 | queen7 | queen8 |
| :--: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
|  1   |   8    |   4    |   1    |   3    |   6    |   2    |   7    |   5    |
|  2   |   8    |   3    |   1    |   6    |   2    |   5    |   7    |   4    |
|  3   |   8    |   2    |   5    |   3    |   1    |   7    |   4    |   6    |
|  4   |   8    |   2    |   4    |   1    |   7    |   5    |   3    |   6    |
|  5   |   7    |   5    |   3    |   1    |   6    |   8    |   2    |   4    |
|  6   |   7    |   4    |   2    |   8    |   6    |   1    |   3    |   5    |
|  7   |   7    |   4    |   2    |   5    |   8    |   1    |   3    |   6    |
|  8   |   7    |   3    |   8    |   2    |   5    |   1    |   6    |   4    |
|  9   |   7    |   3    |   1    |   6    |   8    |   5    |   2    |   4    |
|  10  |   7    |   2    |   6    |   3    |   1    |   4    |   8    |   5    |
|  11  |   7    |   2    |   4    |   1    |   8    |   5    |   3    |   6    |
|  12  |   7    |   1    |   3    |   8    |   6    |   4    |   2    |   5    |
|  13  |   6    |   8    |   2    |   4    |   1    |   7    |   5    |   3    |
|  14  |   6    |   4    |   7    |   1    |   8    |   2    |   5    |   3    |
|  15  |   6    |   4    |   7    |   1    |   3    |   5    |   2    |   8    |
|  16  |   6    |   4    |   2    |   8    |   5    |   7    |   1    |   3    |
|  17  |   6    |   4    |   1    |   5    |   8    |   2    |   7    |   3    |
|  18  |   6    |   3    |   7    |   4    |   1    |   8    |   2    |   5    |
|  19  |   6    |   3    |   7    |   2    |   8    |   5    |   1    |   4    |
|  20  |   6    |   3    |   7    |   2    |   4    |   8    |   1    |   5    |
|  21  |   6    |   3    |   5    |   8    |   1    |   4    |   2    |   7    |
|  22  |   6    |   3    |   5    |   7    |   1    |   4    |   2    |   8    |
|  23  |   6    |   3    |   1    |   8    |   5    |   2    |   4    |   7    |
|  24  |   6    |   3    |   1    |   8    |   4    |   2    |   7    |   5    |
|  25  |   6    |   3    |   1    |   7    |   5    |   8    |   2    |   4    |
|  26  |   6    |   2    |   7    |   1    |   4    |   8    |   5    |   3    |
|  27  |   6    |   2    |   7    |   1    |   3    |   5    |   8    |   4    |
|  28  |   6    |   1    |   5    |   2    |   8    |   3    |   7    |   4    |
|  29  |   5    |   8    |   4    |   1    |   7    |   2    |   6    |   3    |
|  30  |   5    |   8    |   4    |   1    |   3    |   6    |   2    |   7    |
|  31  |   5    |   7    |   4    |   1    |   3    |   8    |   6    |   2    |
|  32  |   5    |   7    |   2    |   6    |   3    |   1    |   8    |   4    |
|  33  |   5    |   7    |   2    |   6    |   3    |   1    |   4    |   8    |
|  34  |   5    |   7    |   2    |   4    |   8    |   1    |   3    |   6    |
|  35  |   5    |   7    |   1    |   4    |   2    |   8    |   6    |   3    |
|  36  |   5    |   7    |   1    |   3    |   8    |   6    |   4    |   2    |
|  37  |   5    |   3    |   8    |   4    |   7    |   1    |   6    |   2    |
|  38  |   5    |   3    |   1    |   7    |   2    |   8    |   6    |   4    |
|  39  |   5    |   3    |   1    |   6    |   8    |   2    |   4    |   7    |
|  40  |   5    |   2    |   8    |   1    |   4    |   7    |   3    |   6    |
|  41  |   5    |   2    |   6    |   1    |   7    |   4    |   8    |   3    |
|  42  |   5    |   2    |   4    |   7    |   3    |   8    |   6    |   1    |
|  43  |   5    |   2    |   4    |   6    |   8    |   3    |   1    |   7    |
|  44  |   5    |   1    |   8    |   6    |   3    |   7    |   2    |   4    |
|  45  |   5    |   1    |   8    |   4    |   2    |   7    |   3    |   6    |
|  46  |   5    |   1    |   4    |   6    |   8    |   2    |   7    |   3    |
|  47  |   4    |   8    |   5    |   3    |   1    |   7    |   2    |   6    |
|  48  |   4    |   8    |   1    |   5    |   7    |   2    |   6    |   3    |
|  49  |   4    |   8    |   1    |   3    |   6    |   2    |   7    |   5    |
|  50  |   4    |   7    |   5    |   3    |   1    |   6    |   8    |   2    |
|  51  |   4    |   7    |   5    |   2    |   6    |   1    |   3    |   8    |
|  52  |   4    |   7    |   3    |   8    |   2    |   5    |   1    |   6    |
|  53  |   4    |   7    |   1    |   8    |   5    |   2    |   6    |   3    |
|  54  |   4    |   6    |   8    |   3    |   1    |   7    |   5    |   2    |
|  55  |   4    |   6    |   8    |   2    |   7    |   1    |   3    |   5    |
|  56  |   4    |   6    |   1    |   5    |   2    |   8    |   3    |   7    |
|  57  |   4    |   2    |   8    |   6    |   1    |   3    |   5    |   7    |
|  58  |   4    |   2    |   8    |   5    |   7    |   1    |   3    |   6    |
|  59  |   4    |   2    |   7    |   5    |   1    |   8    |   6    |   3    |
|  60  |   4    |   2    |   7    |   3    |   6    |   8    |   5    |   1    |
|  61  |   4    |   2    |   7    |   3    |   6    |   8    |   1    |   5    |
|  62  |   4    |   2    |   5    |   8    |   6    |   1    |   3    |   7    |
|  63  |   4    |   1    |   5    |   8    |   6    |   3    |   7    |   2    |
|  64  |   4    |   1    |   5    |   8    |   2    |   7    |   3    |   6    |
|  65  |   3    |   8    |   4    |   7    |   1    |   6    |   2    |   5    |
|  66  |   3    |   7    |   2    |   8    |   6    |   4    |   1    |   5    |
|  67  |   3    |   7    |   2    |   8    |   5    |   1    |   4    |   6    |
|  68  |   3    |   6    |   8    |   2    |   4    |   1    |   7    |   5    |
|  69  |   3    |   6    |   8    |   1    |   5    |   7    |   2    |   4    |
|  70  |   3    |   6    |   8    |   1    |   4    |   7    |   5    |   2    |
|  71  |   3    |   6    |   4    |   2    |   8    |   5    |   7    |   1    |
|  72  |   3    |   6    |   4    |   1    |   8    |   5    |   7    |   2    |
|  73  |   3    |   6    |   2    |   7    |   5    |   1    |   8    |   4    |
|  74  |   3    |   6    |   2    |   7    |   1    |   4    |   8    |   5    |
|  75  |   3    |   6    |   2    |   5    |   8    |   1    |   7    |   4    |
|  76  |   3    |   5    |   8    |   4    |   1    |   7    |   2    |   6    |
|  77  |   3    |   5    |   7    |   1    |   4    |   2    |   8    |   6    |
|  78  |   3    |   5    |   2    |   8    |   6    |   4    |   7    |   1    |
|  79  |   3    |   5    |   2    |   8    |   1    |   7    |   4    |   6    |
|  80  |   3    |   1    |   7    |   5    |   8    |   2    |   4    |   6    |
|  81  |   2    |   8    |   6    |   1    |   3    |   5    |   7    |   4    |
|  82  |   2    |   7    |   5    |   8    |   1    |   4    |   6    |   3    |
|  83  |   2    |   7    |   3    |   6    |   8    |   5    |   1    |   4    |
|  84  |   2    |   6    |   8    |   3    |   1    |   4    |   7    |   5    |
|  85  |   2    |   6    |   1    |   7    |   4    |   8    |   3    |   5    |
|  86  |   2    |   5    |   7    |   4    |   1    |   8    |   6    |   3    |
|  87  |   2    |   5    |   7    |   1    |   3    |   8    |   6    |   4    |
|  88  |   2    |   4    |   6    |   8    |   3    |   1    |   7    |   5    |
|  89  |   1    |   7    |   5    |   8    |   2    |   4    |   6    |   3    |
|  90  |   1    |   7    |   4    |   6    |   8    |   2    |   5    |   3    |
|  91  |   1    |   6    |   8    |   3    |   7    |   4    |   2    |   5    |
|  92  |   1    |   5    |   8    |   6    |   3    |   7    |   2    |   4    |

